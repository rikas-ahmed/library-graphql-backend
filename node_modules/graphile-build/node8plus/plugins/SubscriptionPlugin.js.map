{"version":3,"file":"SubscriptionPlugin.js","names":["isValidSubscription","Subscription","Object","keys","getFields","length","e","description","liveDescription","SubscriptionPlugin","builder","live","hook","schema","build","newWithHooks","extend","graphql","GraphQLObjectType","inflection","name","builtin","wrapDescription","__origin","isRootSubscription","subscription","exports","default"],"sources":["../../src/plugins/SubscriptionPlugin.js"],"sourcesContent":["// @flow\nimport type { Plugin } from \"../SchemaBuilder\";\n\nfunction isValidSubscription(Subscription) {\n  try {\n    if (!Subscription) {\n      return false;\n    }\n    if (Object.keys(Subscription.getFields()).length === 0) {\n      return false;\n    }\n  } catch (e) {\n    return false;\n  }\n  return true;\n}\n\nconst description = `The root subscription type: contains realtime events you can subscribe to with the \\`subscription\\` operation.`;\nconst liveDescription = `The root subscription type: contains events and live queries you can subscribe to with the \\`subscription\\` operation.\n\n#### Live Queries\n\nLive query fields are differentiated by containing \\`(live)\\` at the end of their description, \\\nthey are added for each field in the \\`Query\\` type. \\\nWhen you subscribe to a live query field, the selection set will be evaluated and sent to the \\\nclient, and then most things\\\\* that would cause the output of the selection set to change \\\nwill trigger the selection set to be re-evaluated and the results to be re-sent to the client.\n\n_(\\\\* Not everything: typically only changes to persisted data referenced by the query are detected, not computed fields.)_\n\nLive queries can be very expensive, so try and keep them small and focussed.\n\n#### Events\n\nEvent fields will run their selection set when, and only when, the specified server-side event occurs. \\\nThis makes them a lot more efficient than Live Queries, but it is still recommended that you keep payloads fairly small.`;\n\nexport default (async function SubscriptionPlugin(builder, { live }) {\n  builder.hook(\n    \"GraphQLSchema\",\n    (schema: {}, build) => {\n      const {\n        newWithHooks,\n        extend,\n        graphql: { GraphQLObjectType },\n        inflection,\n      } = build;\n      const Subscription = newWithHooks(\n        GraphQLObjectType,\n        {\n          name: inflection.builtin(\"Subscription\"),\n          description: build.wrapDescription(\n            live ? liveDescription : description,\n            \"type\"\n          ),\n        },\n        {\n          __origin: `graphile-build built-in (root subscription type)`,\n          isRootSubscription: true,\n        },\n        true\n      );\n      if (isValidSubscription(Subscription)) {\n        return extend(\n          schema,\n          {\n            subscription: Subscription,\n          },\n          \"Adding subscription type to schema\"\n        );\n      } else {\n        return schema;\n      }\n    },\n    [\"Subscription\"],\n    [],\n    [\"Query\"]\n  );\n}: Plugin);\n"],"mappings":";;;;;;AAGA,SAASA,mBAAmBA,CAACC,YAAY,EAAE;EACzC,IAAI;IACF,IAAI,CAACA,YAAY,EAAE;MACjB,OAAO,KAAK;IACd;IACA,IAAIC,MAAM,CAACC,IAAI,CAACF,YAAY,CAACG,SAAS,CAAC,CAAC,CAAC,CAACC,MAAM,KAAK,CAAC,EAAE;MACtD,OAAO,KAAK;IACd;EACF,CAAC,CAAC,OAAOC,CAAC,EAAE;IACV,OAAO,KAAK;EACd;EACA,OAAO,IAAI;AACb;AAEA,MAAMC,WAAW,GAAI,gHAA+G;AACpI,MAAMC,eAAe,GAAI;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yHAAyH;AAAC,IAE3FC,kBAAkB,GAAjC,eAAeA,kBAAkBA,CAACC,OAAO,EAAE;EAAEC;AAAK,CAAC,EAAE;EACnED,OAAO,CAACE,IAAI,CACV,eAAe,EACf,CAACC,MAAU,EAAEC,KAAK,KAAK;IACrB,MAAM;MACJC,YAAY;MACZC,MAAM;MACNC,OAAO,EAAE;QAAEC;MAAkB,CAAC;MAC9BC;IACF,CAAC,GAAGL,KAAK;IACT,MAAMb,YAAY,GAAGc,YAAY,CAC/BG,iBAAiB,EACjB;MACEE,IAAI,EAAED,UAAU,CAACE,OAAO,CAAC,cAAc,CAAC;MACxCd,WAAW,EAAEO,KAAK,CAACQ,eAAe,CAChCX,IAAI,GAAGH,eAAe,GAAGD,WAAW,EACpC,MACF;IACF,CAAC,EACD;MACEgB,QAAQ,EAAG,kDAAiD;MAC5DC,kBAAkB,EAAE;IACtB,CAAC,EACD,IACF,CAAC;IACD,IAAIxB,mBAAmB,CAACC,YAAY,CAAC,EAAE;MACrC,OAAOe,MAAM,CACXH,MAAM,EACN;QACEY,YAAY,EAAExB;MAChB,CAAC,EACD,oCACF,CAAC;IACH,CAAC,MAAM;MACL,OAAOY,MAAM;IACf;EACF,CAAC,EACD,CAAC,cAAc,CAAC,EAChB,EAAE,EACF,CAAC,OAAO,CACV,CAAC;AACH,CAAC;AAAAa,OAAA,CAAAC,OAAA,GAAAlB,kBAAA"}