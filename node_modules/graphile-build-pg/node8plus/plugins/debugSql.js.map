{"version":3,"file":"debugSql.js","names":["_debug","_interopRequireDefault","require","_chalk","obj","__esModule","default","formatSQLForDebugging","sql","colourIndex","allowedColours","chalk","red","green","yellow","blue","magenta","cyan","white","black","nextColor","length","colours","colourize","str","bold","call","indentLevel","handleIndent","all","rawMatch","match","replace","repeat","tidySql","gray","colouredSql","rawDebugSql","debugFactory","debugSql","enabled","Object","assign","_default","exports"],"sources":["../../src/plugins/debugSql.js"],"sourcesContent":["import debugFactory from \"debug\";\nimport chalk from \"chalk\";\n\nexport function formatSQLForDebugging(sql) {\n  let colourIndex = 0;\n  const allowedColours = [\n    chalk.red,\n    chalk.green,\n    chalk.yellow,\n    chalk.blue,\n    chalk.magenta,\n    chalk.cyan,\n    chalk.white,\n    chalk.black,\n  ];\n  function nextColor() {\n    colourIndex = (colourIndex + 1) % allowedColours.length;\n    return allowedColours[colourIndex];\n  }\n  const colours = {};\n\n  /* Yep - that's `colour` from English and `ize` from American */\n  function colourize(str) {\n    if (!colours[str]) {\n      colours[str] = nextColor();\n    }\n    return colours[str].bold.call(null, str);\n  }\n\n  let indentLevel = 0;\n  function handleIndent(all, rawMatch) {\n    const match = rawMatch.replace(/ $/, \"\");\n    if (match === \"(\") {\n      indentLevel++;\n      return match + \"\\n\" + \"  \".repeat(indentLevel);\n    } else if (match === \")\") {\n      indentLevel--;\n      return \"\\n\" + \"  \".repeat(indentLevel) + match;\n    } else if (match === \"),\") {\n      indentLevel--;\n      return (\n        \"\\n\" +\n        \"  \".repeat(indentLevel) +\n        match +\n        \"\\n\" +\n        \"  \".repeat(indentLevel)\n      );\n    } else if (match === \",\") {\n      return match + \"\\n\" + \"  \".repeat(indentLevel);\n    } else {\n      return \"\\n\" + \"  \".repeat(indentLevel) + match.replace(/^\\s+/, \"\");\n    }\n  }\n  const tidySql = sql\n    .replace(/\\s+/g, \" \")\n    .replace(/\\s+(?=$|\\n|\\))/g, \"\")\n    .replace(/(\\n|^|\\()\\s+/g, \"$1\")\n    .replace(\n      /(\\(|\\)|\\), ?|, ?| (select|insert|update|delete|from|where|and|or|order|limit)(?= ))/g,\n      handleIndent\n    )\n    .replace(/\\(\\s*([A-Za-z0-9_.\"' =]{1,50})\\s*\\)/g, \"($1)\")\n    .replace(/\\(\\s*(\\([A-Za-z0-9_.\"' =]{1,50}\\))\\s*\\)/g, \"($1)\")\n    .replace(/\\n\\s*and \\(TRUE\\)/g, chalk.gray(\" and (TRUE)\"));\n  const colouredSql = tidySql.replace(/__local_[0-9]+__/g, colourize);\n  return colouredSql;\n}\n\nconst rawDebugSql = debugFactory(\"graphile-build-pg:sql\");\n\nfunction debugSql(sql) {\n  if (!rawDebugSql.enabled) {\n    return;\n  }\n  rawDebugSql(\"%s\", \"\\n\" + formatSQLForDebugging(sql));\n}\nObject.assign(debugSql, rawDebugSql);\n\nexport default debugSql;\n"],"mappings":"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"}