{"version":3,"file":"PgOrderAllColumnsPlugin.js","names":["PgOrderAllColumnsPlugin","builder","hook","values","build","context","extend","pgColumnFilter","inflection","pgOmit","omit","describePgEntity","sqlCommentByAddingTags","scope","isPgRowSortEnum","pgIntrospection","table","kind","attributes","reduce","memo","attr","unique","isUnique","ascFieldName","orderByColumnEnum","descFieldName","value","alias","toLowerCase","specs","name","exports","default"],"sources":["../../src/plugins/PgOrderAllColumnsPlugin.js"],"sourcesContent":["// @flow\nimport type { Plugin } from \"graphile-build\";\n\nexport default (function PgOrderAllColumnsPlugin(builder) {\n  builder.hook(\n    \"GraphQLEnumType:values\",\n    (values, build, context) => {\n      const {\n        extend,\n        pgColumnFilter,\n        inflection,\n        pgOmit: omit,\n        describePgEntity,\n        sqlCommentByAddingTags,\n      } = build;\n      const {\n        scope: { isPgRowSortEnum, pgIntrospection: table },\n      } = context;\n      if (!isPgRowSortEnum || !table || table.kind !== \"class\") {\n        return values;\n      }\n      return extend(\n        values,\n        table.attributes.reduce((memo, attr) => {\n          // PERFORMANCE: These used to be .filter(...) calls\n          if (!pgColumnFilter(attr, build, context)) return memo;\n          if (omit(attr, \"order\")) return memo;\n          const unique = attr.isUnique;\n\n          const ascFieldName = inflection.orderByColumnEnum(attr, true);\n          const descFieldName = inflection.orderByColumnEnum(attr, false);\n          memo = extend(\n            memo,\n            {\n              [ascFieldName]: {\n                value: {\n                  alias: ascFieldName.toLowerCase(),\n                  specs: [[attr.name, true]],\n                  unique,\n                },\n              },\n            },\n            `Adding ascending orderBy enum value for ${describePgEntity(\n              attr\n            )}. You can rename this field with a 'Smart Comment':\\n\\n  ${sqlCommentByAddingTags(\n              attr,\n              {\n                name: \"newNameHere\",\n              }\n            )}`\n          );\n          memo = extend(\n            memo,\n            {\n              [descFieldName]: {\n                value: {\n                  alias: descFieldName.toLowerCase(),\n                  specs: [[attr.name, false]],\n                  unique,\n                },\n              },\n            },\n            `Adding descending orderBy enum value for ${describePgEntity(\n              attr\n            )}. You can rename this field with a 'Smart Comment':\\n\\n  ${sqlCommentByAddingTags(\n              attr,\n              {\n                name: \"newNameHere\",\n              }\n            )}`\n          );\n          return memo;\n        }, {}),\n        `Adding order values from table '${table.name}'`\n      );\n    },\n    [\"PgOrderAllColumns\"]\n  );\n}: Plugin);\n"],"mappings":";;;;;;IAGyBA,uBAAuB,GAAhC,SAASA,uBAAuBA,CAACC,OAAO,EAAE;EACxDA,OAAO,CAACC,IAAI,CACV,wBAAwB,EACxB,CAACC,MAAM,EAAEC,KAAK,EAAEC,OAAO,KAAK;IAC1B,MAAM;MACJC,MAAM;MACNC,cAAc;MACdC,UAAU;MACVC,MAAM,EAAEC,IAAI;MACZC,gBAAgB;MAChBC;IACF,CAAC,GAAGR,KAAK;IACT,MAAM;MACJS,KAAK,EAAE;QAAEC,eAAe;QAAEC,eAAe,EAAEC;MAAM;IACnD,CAAC,GAAGX,OAAO;IACX,IAAI,CAACS,eAAe,IAAI,CAACE,KAAK,IAAIA,KAAK,CAACC,IAAI,KAAK,OAAO,EAAE;MACxD,OAAOd,MAAM;IACf;IACA,OAAOG,MAAM,CACXH,MAAM,EACNa,KAAK,CAACE,UAAU,CAACC,MAAM,CAAC,CAACC,IAAI,EAAEC,IAAI,KAAK;MACtC;MACA,IAAI,CAACd,cAAc,CAACc,IAAI,EAAEjB,KAAK,EAAEC,OAAO,CAAC,EAAE,OAAOe,IAAI;MACtD,IAAIV,IAAI,CAACW,IAAI,EAAE,OAAO,CAAC,EAAE,OAAOD,IAAI;MACpC,MAAME,MAAM,GAAGD,IAAI,CAACE,QAAQ;MAE5B,MAAMC,YAAY,GAAGhB,UAAU,CAACiB,iBAAiB,CAACJ,IAAI,EAAE,IAAI,CAAC;MAC7D,MAAMK,aAAa,GAAGlB,UAAU,CAACiB,iBAAiB,CAACJ,IAAI,EAAE,KAAK,CAAC;MAC/DD,IAAI,GAAGd,MAAM,CACXc,IAAI,EACJ;QACE,CAACI,YAAY,GAAG;UACdG,KAAK,EAAE;YACLC,KAAK,EAAEJ,YAAY,CAACK,WAAW,CAAC,CAAC;YACjCC,KAAK,EAAE,CAAC,CAACT,IAAI,CAACU,IAAI,EAAE,IAAI,CAAC,CAAC;YAC1BT;UACF;QACF;MACF,CAAC,EACA,2CAA0CX,gBAAgB,CACzDU,IACF,CAAE,4DAA2DT,sBAAsB,CACjFS,IAAI,EACJ;QACEU,IAAI,EAAE;MACR,CACF,CAAE,EACJ,CAAC;MACDX,IAAI,GAAGd,MAAM,CACXc,IAAI,EACJ;QACE,CAACM,aAAa,GAAG;UACfC,KAAK,EAAE;YACLC,KAAK,EAAEF,aAAa,CAACG,WAAW,CAAC,CAAC;YAClCC,KAAK,EAAE,CAAC,CAACT,IAAI,CAACU,IAAI,EAAE,KAAK,CAAC,CAAC;YAC3BT;UACF;QACF;MACF,CAAC,EACA,4CAA2CX,gBAAgB,CAC1DU,IACF,CAAE,4DAA2DT,sBAAsB,CACjFS,IAAI,EACJ;QACEU,IAAI,EAAE;MACR,CACF,CAAE,EACJ,CAAC;MACD,OAAOX,IAAI;IACb,CAAC,EAAE,CAAC,CAAC,CAAC,EACL,mCAAkCJ,KAAK,CAACe,IAAK,GAChD,CAAC;EACH,CAAC,EACD,CAAC,mBAAmB,CACtB,CAAC;AACH,CAAC;AAAAC,OAAA,CAAAC,OAAA,GAAAjC,uBAAA"}